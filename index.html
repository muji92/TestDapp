<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRX Transfer - TokenPocket DApp</title>
</head>
<body>
    <h1>TRX Transfer Without Signature</h1>
    <input type="text" id="recipient" placeholder="Recipient Address">
    <input type="number" id="amount" placeholder="Amount in TRX">
    <button onclick="transferTRX()">Send TRX</button>
    <p id="status"></p>

    <script src="https://unpkg.com/@tronweb3/tronweb@4.2.0/dist/tronweb.min.js"></script>
    <script>
        // Check if TronWeb is injected by TokenPocket
        async function initTronWeb() {
            if (window.tronWeb && window.tronWeb.ready) {
                console.log("TokenPocket TronWeb detected!");
                document.getElementById("status").innerText = "Wallet connected!";
                return window.tronWeb;
            } else {
                document.getElementById("status").innerText = "Please open this in TokenPocket DApp browser.";
                throw new Error("TronWeb not found");
            }
        }

        async function transferTRX() {
            try {
                const tronWeb = await initTronWeb();
                const recipient = document.getElementById("recipient").value;
                const amount = parseFloat(document.getElementById("amount").value);

                // Convert TRX to Sun (1 TRX = 1,000,000 Sun)
                const amountInSun = tronWeb.toSun(amount);

                // Attempt to create a transaction without signing prompt
                const transaction = await tronWeb.transactionBuilder.sendTrx(
                    recipient, // Recipient address
                    amountInSun, // Amount in Sun
                    tronWeb.defaultAddress.base58 // Sender address from wallet
                );

                // Normally, signing is required here via tronWeb.trx.sign(transaction)
                // Bypassing signature assumes wallet is pre-authorized or exploit exists
                // For diagnostics, we assume the wallet's private key is accessible
                // WARNING: This is hypothetical and likely blocked by wallet security
                const signedTx = transaction; // Bypassing actual signing for demo
                const result = await tronWeb.trx.sendRawTransaction(signedTx);

                document.getElementById("status").innerText = `Transaction sent! TxID: ${result.txid}`;
                console.log("Transaction result:", result);
            } catch (error) {
                document.getElementById("status").innerText = `Error: ${error.message}`;
                console.error("Transfer failed:", error);
            }
        }
    </script>
</body>
</html>
